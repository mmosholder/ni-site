<template>
  <div>
     <section :class="['ni-profile ni-profile-' + story.content.color]" v-editable="story.content">
      <div class="ni-container">
        <div class="ni-row">
          <div class="ni-profile-left">
            <img class="-logo" :src="story.content.secondary_image" :alt="story.content.name" v-if="story.content.secondary_image">
            <img class="-can" :src="story.content.main_image" :alt="story.content.name" v-if="story.content.main_image">
            <nuxt-link :class="['ni-profile-left-link ni-profile-left-link-' + story.content.color]" :to="'/beers'">&lt; Back to All Beers</nuxt-link>
          </div>
          <div class="ni-profile-right">
            <div class="ni-profile-title">
              <h1>{{story.content.name}}</h1>
              <p>{{ story.content.short_description }}</p>
            </div>
            <div class="ni-profile-science">
              <h2>The Science</h2>
              <p v-if="story.content.science_blurb">{{ story.content.science_blurb }}</p>
              <ul class="ni-profile-science-list">
                <li>
                  <svg width="30" height="29" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#231F20" fill-rule="nonzero">
                      <path d="M24.771 14.772V7.59a.973.973 0 0 0-.773-.954c-.59-.091-1.045.364-1.045.909v7.227c0 1.09-.5 2.09-1.363 2.727l-4.818 3.681a4.116 4.116 0 0 1-1.182.591v-1.363c0-.546.273-1.091.727-1.41l4.227-3.226a.949.949 0 0 0 .364-.728V2.727a.973.973 0 0 0-.773-.954c-.59-.091-1.045.363-1.045.909v1.454l-.591.455-2.136 1.59a.492.492 0 0 1-.773-.409V1a.973.973 0 0 0-.773-.955c-.59-.09-1.045.364-1.045.91v3.954c0 .727-.864 1.182-1.455.727l-1.409-1.045-.59-.455v-1.5c0-.318-.182-.636-.455-.818-.682-.318-1.364.136-1.364.818v12.408c0 .273.137.546.364.728l4 3.045c.59.454.954 1.182.954 1.909v1.045a4.116 4.116 0 0 1-1.181-.59l-4.818-3.682a3.423 3.423 0 0 1-1.364-2.727V7.59a.973.973 0 0 0-.773-.954c-.59-.091-1.045.364-1.045.909v7.227c0 1.636.773 3.181 2.09 4.181l4.819 3.682c.681.5 1.454.863 2.272 1v3.545c0 .455.318.864.773.955.59.09 1.045-.364 1.045-.91v-3.59c.818-.137 1.591-.5 2.273-1l4.818-3.682a5.343 5.343 0 0 0 2.045-4.181zM15.59 9.818c0-.5.227-.91.59-1.228l2.864-2.181v2.227c0 .454-.227.863-.545 1.136l-.046.046-2.863 2.181V9.818zm.09 4.408l3.364-2.545v2.364c0 .363-.182.727-.5.954l-3 2.273v-2.818c.046-.137.091-.182.137-.228zm-1.908 3l-3.454-2.636v-2.454c0-.182.227-.319.363-.182l3.09 2.363v2.91zm0-7.408v2.181l-2.864-2.181-.59-.455V6.909c0-.182.227-.319.363-.182l3 2.272c.045.046.09.137.09.182v.637zM10.454 25.044l-5.273-4a7.492 7.492 0 0 1-2.954-5.954c0-.5-.409-.91-.909-.91s-.909.41-.909.91c0 2.909 1.364 5.681 3.682 7.409l5.272 4a.873.873 0 0 0 .545.181.949.949 0 0 0 .728-.364c.318-.409.227-1-.182-1.272zM28.68 14.135c-.5 0-.91.41-.91.91a7.492 7.492 0 0 1-2.953 5.954l-5.273 4.045c-.409.318-.454.863-.182 1.272a.949.949 0 0 0 .728.364.873.873 0 0 0 .545-.182l5.272-4.045c2.318-1.773 3.682-4.545 3.682-7.409 0-.5-.41-.909-.909-.909z"/>
                    </g>
                  </svg>
                  <p>{{story.content.malt}}</p>
                </li>
                <li>
                  <svg width="30" height="29" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#231F20" fill-rule="nonzero">
                      <path d="M28.161 11.016c0-.514-.471-.943-.985-.857-.43.043-.73.471-.73.943-.042 5.872-4.414 10.673-10.115 11.444-.3.043-.514-.171-.514-.471v-1.586c0-.515.343-.9.857-.986 4.415-.772 7.801-4.672 7.801-9.301 0 0 0-.043-.043-.043-.428 0-.857.043-1.243.085-.3.043-.514-.214-.514-.514.257-2.4-1.243-4.672-1.286-4.8a.942.942 0 0 0-.9-.386c-.129.042-.472.128-1.157.514h-.043C18.089 1.886 15.474.6 15.345.514a.736.736 0 0 0-.728 0c-.13.043-2.53 1.243-3.772 4.115-.086.215-.386.343-.6.215-.43-.215-.686-.258-.772-.3-.343-.086-.686.085-.9.385-.086.129-1.8 2.786-1.2 5.358 0 0 0 .043-.043.043a8.54 8.54 0 0 0-1.8-.171s-.043 0-.043.043c0 4.629 3.343 8.487 7.758 9.301.471.086.857.514.857.986v2.014c0 .086 0 .086-.043.086-6-.386-10.801-5.4-10.844-11.487 0-.429-.3-.858-.729-.943-.514-.086-.986.343-.986.857 0 6.858 5.23 12.516 11.916 13.245a.785.785 0 0 1 .686.771v2.23c0 .428.3.857.729.9.514.085.986-.343.986-.858v-3s0-.043.043-.043c6.858-.472 12.301-6.258 12.301-13.245zm-5.829 1.672a7.888 7.888 0 0 1-5.358 4.972s-.043 0-.043-.043c.686-2.486 2.53-4.5 4.972-5.358.3-.086.515.171.429.429zM19.589 6.9c.428-.257.9-.086 1.071.386.386 1.029.643 2.4-.085 3.558 0 .042-.043.042-.043.085-.043.043-.043.086-.086.172-.3.128-.557.3-.814.428h-.043a11.567 11.567 0 0 0-.686-2.057 10.348 10.348 0 0 0-.815-1.415v-.042c.558-.558 1.072-.9 1.5-1.115zm-4.972-4.372c.214-.171.514-.171.771 0 .772.557 1.886 1.672 2.443 3.472l-.385.257-.515.386h-.043a3.003 3.003 0 0 0-.428-.343 6.594 6.594 0 0 0-1.115-.729.736.736 0 0 0-.728 0c-.043.043-.558.257-1.2.772a2.147 2.147 0 0 0-.344.3c-.128-.086-.257-.214-.385-.3l-.515-.386v-.043a6.85 6.85 0 0 1 2.444-3.386zM9.644 6.472c.043 0 .043 0 0 0 .258.086.515.258.858.472.128.086.257.171.428.257.129.086.257.172.429.3.343.214.429.686.214 1.029a4.434 4.434 0 0 0-.471.9 9.983 9.983 0 0 0-.472 1.2c-.128.429-.643.643-1.071.472h-.043c-.043-.043-.043-.129-.086-.172 0-.043-.043-.043-.043-.085-.9-1.5-.214-3.387.257-4.373zm-2.143 5.616c2.186.6 4.03 2.1 4.972 4.114a.679.679 0 0 1-.9.9c-1.972-.942-3.515-2.786-4.072-5.014-.043.042 0 0 0 0zm7.673 5.743c-.043 0-.129-.043-.215-.043h-.128a9.412 9.412 0 0 0-2.915-5.186v-.043c.429-3.172 2.229-4.715 3.043-5.272h.043c.815.557 2.615 2.057 3.044 5.272v.043a9.584 9.584 0 0 0-2.872 5.23zM29.362 18.517a.831.831 0 0 0-1.158.3c-1.586 2.658-3.9 4.8-6.686 6.13a.859.859 0 0 0-.386 1.157c.128.3.471.471.771.471.129 0 .258-.042.386-.085a17.514 17.514 0 0 0 7.416-6.816.958.958 0 0 0-.343-1.157zM7.458 24.604a15.272 15.272 0 0 1-5.443-5.015c-.258-.386-.815-.515-1.2-.215-.386.258-.515.772-.258 1.158 1.543 2.314 3.644 4.2 6.044 5.53.129.085.257.085.429.085.3 0 .6-.172.771-.429a.806.806 0 0 0-.343-1.114z"/>
                    </g>
                  </svg>
                  <p>{{story.content.hops}}</p>
                </li>
                <li>
                  <svg width="30" height="30" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#231F20" fill-rule="nonzero">
                      <path d="M24.094 16.36c1.218.328 2.437.703 4.875.703.468 0 .89-.329.984-.75.094-.61-.328-1.125-.937-1.125-2.203 0-3.282-.282-4.407-.61a15.52 15.52 0 0 0-2.672-.562v-3.047c0-.328.329-.61.657-.563.562.094 1.031.235 1.5.375 1.218.328 2.437.703 4.875.703.468 0 .89-.328.984-.75.094-.609-.328-1.125-.937-1.125-2.203 0-3.282-.28-4.407-.609a15.52 15.52 0 0 0-2.672-.563V3.095A3.09 3.09 0 0 0 18.845 0h-7.172a3.09 3.09 0 0 0-3.094 3.094v6.375c-1.125-.094-1.875-.328-2.625-.516-1.219-.328-2.437-.703-4.875-.703-.469 0-.89.328-.984.75-.094.61.328 1.125.937 1.125 2.203 0 3.282.281 4.407.61.89.234 1.78.515 3.14.609v3.094a.57.57 0 0 1-.656.562c-.797-.094-1.406-.281-2.016-.469-1.218-.328-2.437-.703-4.875-.703-.468 0-.89.328-.984.75-.094.61.328 1.125.937 1.125 2.204 0 3.282.281 4.407.61.89.234 1.78.515 3.14.609v3.703c-1.125-.094-1.875-.328-2.625-.516-1.218-.328-2.437-.703-4.875-.703-.468 0-.89.328-.984.75-.094.61.328 1.125.937 1.125 2.204 0 3.282.282 4.407.61.75.234 1.546.422 2.671.562a.557.557 0 0 1 .47.563v5.859c0 .469.327.89.796.984.61.094 1.078-.375 1.078-.937v-5.344l4.781 4.172 4.782-4.172v5.344c0 .469.328.89.797.984.609.094 1.078-.375 1.078-.937v-7.5c.843.14 1.5.281 2.156.468 1.219.329 2.438.704 4.875.704.469 0 .89-.328.984-.75.094-.61-.328-1.125-.937-1.125-2.203 0-3.281-.282-4.406-.61a17.441 17.441 0 0 0-1.97-.468c-.421-.047-.702-.422-.702-.844v-3c.937.14 1.593.328 2.25.515zm-4.5 5.109l-4.36 3.843-4.359-3.843a1.18 1.18 0 0 1-.422-.938V9.234a.64.64 0 0 1 .656-.656c1.922-.094 3.094-.422 4.22-.75 1.265-.375 2.437-.703 4.78-.703v13.453c-.093.328-.234.656-.515.89zm.422-16.266c-2.578.047-3.938.422-5.25.797-1.172.328-2.297.656-4.313.703v-3.61c0-.655.563-1.218 1.219-1.218h7.125c.656 0 1.219.563 1.219 1.219v2.11z"/>
                      <path d="M15.422 16.266c.234.375.656.609 1.125.609.656 0 1.172-.469 1.312-1.078v-.235c0-.75-.609-1.312-1.312-1.312-.75 0-1.313.61-1.313 1.313 0 .28.094.515.188.703zM15 11.39c0-.187-.047-.374-.14-.562-.188-.469-.657-.75-1.22-.75-.703 0-1.265.563-1.312 1.266v.047c0 .75.61 1.312 1.313 1.312.796 0 1.359-.61 1.359-1.312zM14.531 18.375c-.75 0-1.312.61-1.312 1.313 0 .28.094.562.234.796.235.328.61.563 1.078.563.656 0 1.219-.516 1.313-1.172v-.14c0-.75-.61-1.36-1.313-1.36z"/>
                    </g>
                  </svg>
                  <p>{{story.content.yeast}}</p>
                </li>
              </ul>
            </div>
            <div class="ni-profile-story" v-if="story.content.story_text">
              <h2>The Story</h2>
              <p>{{ story.content.story_text }}</p>
            </div>
            <div class="ni-profile-info">
              <h2>Gotta Have It?</h2>
              <p :class="['ni-profile-info-' + story.content.color]">Check out our <a href="/beerfinder">Beerfinder</a> to find a bar or retailer near you</p>
              <p :class="['ni-profile-info-' + story.content.color]">{{ story.content.name }} is currently <strong>{{ computedStatus }}</strong> at the taproom. <a v-if="story.content.on_tap" href="/taproom">See our location</a>.</p>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="ni-profile-grid" v-if="story.content.grid_images && story.content.grid_images.length > 0">
      <div class="ni-container">
        <div class="ni-row">
          <div class="ni-profile-grid-image" v-for="(item, i) in story.content.grid_images" :key="i">
            <SingleImage :item="item" />
          </div>
        </div>
      </div>
    </section>
    <section class="ni-cta ni-cta-newsletter">
      <div class="ni-container">
        <div class="ni-row">
          <div class="ni-cta-card">
            <div class="ni-cta-content-wrapper">
              <div class="ni-row">
                <div class="ni-cta-content">
                  <h2>We're pretty fun</h2>
                  <p>And we want you to have fun with us! Sign up to receive our newsletter, which includes perks and first-to-know updates about new beers &amp; events.</p>
                  <div class="ni-cta-signup">
                    <form>
                      <input class="cta-input" type="email" placeholder="yourname@email.com">
                      <button class="button button-green" type="submit">Sign Me Up</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</template>

<script>
import SingleImage from "~/components/SingleImage";

export default {
  components: { SingleImage },

  data () {
    return { story: { content: {} } }
  },

  mounted () {
    this.$storyblok.init()
    this.$storyblok.on('change', () => {
      location.reload(true)
    })
    this.$storyblok.on('published', () => {
      location.reload(true)
    })
  },

  asyncData (context) {
    let version = context.query._storyblok || context.isDev ? 'draft' : 'published'

    return context.app.$storyapi.get(`cdn/stories/beers/${context.params.slug}`, {
      version: version
    }).then((res) => {
      return res.data
    }).catch((res) => {
      context.error({ message: res.response.data })
    })
  },

  computed: {
    computedStatus() {
      if (this.story.content.on_tap) {
        return 'ON TAP';
      } else {
        return 'not on tap';
      }
    }
  }
}
</script>
